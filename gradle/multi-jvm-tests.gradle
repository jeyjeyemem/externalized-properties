// Ideally every LTS release (after the toolchain's Java language version) 
// plus the latest released Java version.
def additionalTestRunsOnJavaVersions = 
    System.getenv("ADDITIONAL_TEST_RUNS_ON_JAVA_VERSIONS") ?:
    System.getProperties().getOrDefault("additionalTestRunsOnJavaVersions", "17,18")

additionalTestRunsOnJavaVersions.split(",").each { javaVersion ->
    def testTaskName = "testOnJava${javaVersion}"
    tasks.register(testTaskName, Test) {
        useJUnitPlatform()
        javaLauncher = javaToolchains.launcherFor {
            languageVersion = JavaLanguageVersion.of(javaVersion)
        }
    }
    tasks.named("check").configure {
        dependsOn tasks.named(testTaskName)
    }
}